# Ignition æ–‡ä»¶å’Œç›‘æ§è¯´æ˜

## Ignition æ–‡ä»¶ç”Ÿæˆ

åœ¨ `ocpack generate-iso` æˆ– `ocpack setup-pxe` è¿‡ç¨‹ä¸­ï¼Œä¼šç”Ÿæˆä»¥ä¸‹é‡è¦æ–‡ä»¶ç”¨äºé›†ç¾¤å®‰è£…å’Œç›‘æ§ï¼š

### ç”Ÿæˆçš„æ–‡ä»¶ç»“æ„

```
my-cluster/
â”œâ”€â”€ installation/
â”‚   â”œâ”€â”€ ignition/                    # ç›‘æ§ç›®å½•
â”‚   â”‚   â”œâ”€â”€ auth/                    # é›†ç¾¤è®¤è¯ä¿¡æ¯
â”‚   â”‚   â”‚   â”œâ”€â”€ kubeconfig          # Kubernetes é…ç½®æ–‡ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ kubeadmin-password  # ç®¡ç†å‘˜å¯†ç 
â”‚   â”‚   â”œâ”€â”€ .openshift_install.log  # å®‰è£…æ—¥å¿—
â”‚   â”‚   â””â”€â”€ .openshift_install_state.json  # å®‰è£…çŠ¶æ€
â”‚   â”œâ”€â”€ iso/                         # ISO æ–‡ä»¶ç›®å½•
â”‚   â”‚   â””â”€â”€ my-cluster-agent.x86_64.iso
â”‚   â”œâ”€â”€ install-config.yaml          # å®‰è£…é…ç½®
â”‚   â””â”€â”€ agent-config.yaml            # Agent é…ç½®
```

### æ–‡ä»¶è¯´æ˜

#### 1. install-config.yaml
åŒ…å«é›†ç¾¤çš„åŸºæœ¬é…ç½®ä¿¡æ¯ï¼š
- é›†ç¾¤åç§°å’ŒåŸŸå
- ç½‘ç»œé…ç½®
- èŠ‚ç‚¹è§„æ ¼
- Pull Secret
- SSH å…¬é’¥
- é•œåƒæºé…ç½®

#### 2. agent-config.yaml
åŒ…å« Agent-based å®‰è£…çš„ç‰¹å®šé…ç½®ï¼š
- ä¸»æœºé…ç½®ï¼ˆIPã€MAC åœ°å€ï¼‰
- ç½‘ç»œæ¥å£é…ç½®
- Rendezvous IP
- DNS æœåŠ¡å™¨

#### 3. ignition/ ç›®å½•
è¿™æ˜¯ç›‘æ§åŠŸèƒ½ä½¿ç”¨çš„å…³é”®ç›®å½•ï¼š
- **auth/**: åŒ…å«é›†ç¾¤è®¿é—®å‡­æ®
- **.openshift_install.log**: è¯¦ç»†çš„å®‰è£…æ—¥å¿—
- **.openshift_install_state.json**: å®‰è£…çŠ¶æ€å’Œè¿›åº¦ä¿¡æ¯

## ç›‘æ§å·¥ä½œåŸç†

### ç›‘æ§å‘½ä»¤æ‰§è¡Œæµç¨‹

1. **æŸ¥æ‰¾ openshift-install å·¥å…·**
   - ä¼˜å…ˆä½¿ç”¨ä» registry æå–çš„ç‰ˆæœ¬
   - å›é€€åˆ°ä¸‹è½½çš„ç‰ˆæœ¬
   - æœ€åå°è¯•ç³»ç»Ÿè·¯å¾„

2. **è¯»å–å®‰è£…æ—¥å¿—æ–‡ä»¶**
   - è¯»å– `.openshift_install.log` æ–‡ä»¶
   - æ˜¾ç¤ºæœ€è¿‘çš„é‡è¦æ—¥å¿—æ¡ç›®ï¼ˆæœ€å10æ¡ï¼‰
   - åˆ†ææ—¥å¿—å†…å®¹ç¡®å®šå½“å‰å®‰è£…é˜¶æ®µ

3. **æ‰§è¡Œç›‘æ§å‘½ä»¤**
   ```bash
   openshift-install agent wait-for install-complete --dir ignition/
   ```

4. **ç»¼åˆåˆ†æçŠ¶æ€**
   - ç»“åˆæ—¥å¿—æ–‡ä»¶å’Œå‘½ä»¤è¾“å‡ºåˆ†æçŠ¶æ€
   - å³ä½¿å‘½ä»¤æ— æ–°è¾“å‡ºä¹Ÿèƒ½æ˜¾ç¤ºå†å²ä¿¡æ¯
   - æä¾›å‡†ç¡®çš„å®‰è£…é˜¶æ®µå’Œè¿›åº¦ä¿¡æ¯

### ç›‘æ§çŠ¶æ€è¯´æ˜

| çŠ¶æ€ | å›¾æ ‡ | è¯´æ˜ |
|------|------|------|
| éªŒè¯ä¸­ | ğŸ” | é›†ç¾¤æ­£åœ¨è¿›è¡Œå®‰è£…å‰éªŒè¯ |
| ç­‰å¾…ä¸­ | â³ | ç­‰å¾…é›†ç¾¤åˆå§‹åŒ–æˆ–ç»„ä»¶å¯åŠ¨ |
| å®‰è£…ä¸­ | ğŸ”„ | æ­£åœ¨å®‰è£…é›†ç¾¤ç»„ä»¶ |
| APIåˆå§‹åŒ– | ğŸ”§ | Kubernetes APIå·²åˆå§‹åŒ– |
| Bootstrapå®Œæˆ | ğŸš€ | Bootstrapé˜¶æ®µå·²å®Œæˆ |
| é›†ç¾¤åˆå§‹åŒ– | âš™ï¸ | é›†ç¾¤æ­£åœ¨åˆå§‹åŒ–ï¼Œæ˜¾ç¤ºè¯¦ç»†è¿›åº¦ |
| å®Œæˆ | âœ… | é›†ç¾¤å®‰è£…å·²å®Œæˆ |
| é”™è¯¯ | âŒ | å®‰è£…è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ |

### æ—¥å¿—çº§åˆ«è¯´æ˜

ç›‘æ§è¿‡ç¨‹ä¸­ä¼šæ˜¾ç¤ºä¸åŒçº§åˆ«çš„æ—¥å¿—ä¿¡æ¯ï¼š

| å›¾æ ‡ | çº§åˆ« | è¯´æ˜ |
|------|------|------|
| â„¹ï¸ | INFO | ä¸€èˆ¬ä¿¡æ¯ï¼Œå¦‚å®‰è£…è¿›åº¦ |
| âš ï¸ | WARNING | è­¦å‘Šä¿¡æ¯ï¼Œé€šå¸¸æ˜¯éªŒè¯å¤±è´¥æˆ–é…ç½®é—®é¢˜ |
| âŒ | ERROR | é”™è¯¯ä¿¡æ¯ï¼Œéœ€è¦ç«‹å³å…³æ³¨ |
| ğŸ”„ | STATUS | ä¸»æœºçŠ¶æ€æ›´æ–°ä¿¡æ¯ |

## ä½¿ç”¨ç›‘æ§åŠŸèƒ½

### åŸºæœ¬ç”¨æ³•

```bash
# æŒç»­ç›‘æ§å®‰è£…è¿›åº¦
ocpack mon my-cluster

# è·å–é›†ç¾¤å‡­æ®
ocpack mon my-cluster --credentials
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ignition ç›®å½•ä¸å­˜åœ¨**
   ```
   âŒ ignition ç›®å½•ä¸å­˜åœ¨: /path/to/cluster/installation/ignition
   ```
   **è§£å†³æ–¹æ¡ˆ**: ç¡®ä¿å·²ç»è¿è¡Œ `ocpack generate-iso` ç”Ÿæˆäº† ISO æ–‡ä»¶æˆ– `ocpack setup-pxe` è®¾ç½®äº† PXE ç¯å¢ƒ

2. **æ‰¾ä¸åˆ° openshift-install å·¥å…·**
   ```
   âŒ æ‰¾ä¸åˆ° openshift-install å·¥å…·
   ```
   **è§£å†³æ–¹æ¡ˆ**: 
   - ç¡®ä¿å·²ç»è¿è¡Œ `ocpack download` ä¸‹è½½äº†å®‰è£…å·¥å…·
   - æ”¯æŒå¸¦ç‰ˆæœ¬å·çš„æ–‡ä»¶åï¼ˆå¦‚ `openshift-install-4.17.0-registry.dr.example.com`ï¼‰
   - å¯ä»¥åœ¨é›†ç¾¤ç›®å½•å†…ç›´æ¥æ‰§è¡Œ `ocpack mon cluster-name`
   - å·¥å…·ä¼šè‡ªåŠ¨æŸ¥æ‰¾å½“å‰ç›®å½•ä¸­ä»¥ `openshift-install` å¼€å¤´çš„æ–‡ä»¶

3. **ç›‘æ§è¶…æ—¶**
   ```
   â° ç›‘æ§è¶…æ—¶ (2h0m0s)ï¼Œåœæ­¢ç›‘æ§
   ```
   **è§£å†³æ–¹æ¡ˆ**: å¢åŠ è¶…æ—¶æ—¶é—´æˆ–æ£€æŸ¥é›†ç¾¤å®‰è£…æ˜¯å¦æ­£å¸¸è¿›è¡Œ

### æ‰‹åŠ¨ç›‘æ§

å¦‚æœè‡ªåŠ¨ç›‘æ§æœ‰é—®é¢˜ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œç›‘æ§å‘½ä»¤ï¼š

```bash
cd my-cluster/installation/ignition
../../openshift-install-4.17.0-registry.my-cluster.example.com agent wait-for install-complete --dir .
```

## é›†ç¾¤è®¿é—®

å®‰è£…å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®é›†ç¾¤ï¼š

### 1. ä½¿ç”¨ kubeconfig

```bash
export KUBECONFIG=my-cluster/installation/ignition/auth/kubeconfig
oc get nodes
```

### 2. è·å–ç®¡ç†å‘˜å¯†ç 

```bash
cat my-cluster/installation/ignition/auth/kubeadmin-password
```

### 3. è®¿é—® Web æ§åˆ¶å°

```
URL: https://console-openshift-console.apps.my-cluster.example.com
ç”¨æˆ·å: kubeadmin
å¯†ç : (ä»ä¸Šé¢çš„æ–‡ä»¶è·å–)
```

## æœ€ä½³å®è·µ

1. **ç›‘æ§å»ºè®®**
   - ä½¿ç”¨ `--follow` å‚æ•°æŒç»­ç›‘æ§
   - è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼ˆé€šå¸¸ 2-3 å°æ—¶ï¼‰
   - ä¿å­˜ç›‘æ§æ—¥å¿—ä»¥ä¾¿æ•…éšœæ’é™¤

2. **å®‰å…¨å»ºè®®**
   - å¦¥å–„ä¿ç®¡ kubeconfig å’Œå¯†ç æ–‡ä»¶
   - å®‰è£…å®ŒæˆååŠæ—¶æ›´æ”¹é»˜è®¤å¯†ç 
   - é…ç½®é€‚å½“çš„ RBAC æƒé™

3. **å¤‡ä»½å»ºè®®**
   - å¤‡ä»½æ•´ä¸ª installation ç›®å½•
   - ç‰¹åˆ«æ³¨æ„ auth ç›®å½•ä¸­çš„å‡­æ®æ–‡ä»¶
   - ä¿å­˜å®‰è£…æ—¥å¿—ç”¨äºåç»­å‚è€ƒ 